'use strict';

$(document).ready(function () {
  var step1 = '';
  var step2 = '';
  var orderData = {
    sum: 0,
    term: 0,
    name: '',
    surname: '',
    itn: '',
    city: ''
  };

  var formElements = {
    "sum": function sum(event) {
      checkInputsStep1(event);
    },
    "term": function term(event) {
      checkInputsStep1(event);
    },
    "itn": function itn(event) {
      checkItn(event);
    }
  };

  var handleInputsChange = function handleInputsChange(event) {
    var target = event.target.id;
    for (var key in formElements) {
      if (target.includes(key)) {
        formElements[key](event);
      }
    };
  };

  function checkInputsStep1(event) {
    console.log($(this));
    if ($(this).val() !== '') {
      $(this).addClass("form__input--ok");
      // orderData[inputId] = $(this).val();
    } else {
      $(this).removeClass("form__input--ok");
      orderData[inputId] = 0;
    }
    console.log(orderData);
    if (orderData.sum >= 1 && orderData.sum <= 10000 && orderData.term >= 1 && orderData.term <= 12) {
      step1 = 'ok';
      $("#step1-next-btn").addClass("btn--active");
    } else {
      step1 = 'no';
    }
  };

  function checkItn(event) {
    var msfrom1900 = Date.now() + Math.abs(Date.parse("January 01, 1900"));
    var daysFrom1970 = msfrom1900 / (1000 * 60 * 60 * 24);
    var daysIn21Years = 7670;
    var minItn = daysFrom1970 - daysIn21Years;
    var itn = $('#' + inputId).val();
    var first5CharsItn = itn.slice(0, 4);

    console.log(first5CharsItn);
  };

  // Click handler on the next button on Step1. -> Render Step 2 of form 
  function handleClick(evt) {
    evt.preventDefault();
    $(".form-wrapper").empty();
    var step2Template = _.template(document.getElementById('form-step2-template').innerHTML);
    var formStep2 = step2Template();
    $(".form-wrapper").append(formStep2);
  }

  //Ivent listeners
  $("input").on("change", handleInputsChange);
  $(".btn").click(handleClick);
});